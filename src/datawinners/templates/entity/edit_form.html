{% extends 'layout_application.html' %}
{% load i18n %}

{% block page_title %}{% trans "Subject - Questionnaire" %} {% endblock %}

{% load dw_tabs %}

{% block navigation %}
    {% activetab "tab_nav" "subjects" %}
    {{ block.super }}
{% endblock %}

{% block body %}
    {% activetab "main_nav" "projects" %}
    {{ block.super }}
{% endblock %}

{% block page_scss %}
    {{ block.super }}
    <link href="/media/css/scss/section_subjects_registration.scss" rel="stylesheet"/>
{% endblock %}


{% block page_js %}
    {{ block.super }}
    <script type="text/javascript" src="/media/javascript/project/view_model.js"></script>
    <script type="text/javascript" src="/media/javascript/jquery.sprintf.js"></script>
    <script type="text/javascript" src="/media/javascript/project/questionnaire_charcount.js"></script>
    <script type="text/javascript" src="/media/javascript/project/questionnaire_helper.js"></script>
    <script type="text/javascript" src="/media/javascript/project/sms_preview.js"></script>
    <script type="text/javascript">
        var question_list = $.parseJSON({{existing_questions|safe}});
    </script>
    <script type="text/javascript" src="/media/javascript/project/questionnaire_wizard_submit.js"></script>
    <script type="text/javascript" src="/media/javascript/project/questionnaire_wizard.js"></script>
    <script type="text/javascript" src="/media/javascript/csrf_token_handler.js"></script>
    <script type="text/html" id="choice-template">
        <li>
            <input id="choice_text" name="choice_text" class="required" type="text"
                   data-bind="value: text, uniqueName:true"/>
            <a href="questionnaire_wizard.html#" class='delete delete_link'
               data-bind="visible: viewModel.choiceCanBeDeleted(), click:function(){viewModel.removeOptionFromQuestion($data)}">{% trans "Delete" %}</a>
        </li>
    </script>
    <script type="text/html" id="question-list-template_new">
        <div class="question_list">
             <ul>
             {% templatetag openvariable %}each(i,question) questions{% templatetag closevariable %}
             <div data-bind="click: function() { if($('#question_form').valid()) viewModel.changeSelectedQuestion(question); }, css:{question_selected:question == viewModel.selectedQuestion()} ">
                 <li>
                    <a href="questionnaire_wizard.html#" data-bind="text: question.display"></a>
                     <div data-bind="visible: question.canBeDeleted()" class="question_delete_link delete">
                         <a href="questionnaire_wizard.html#" class="delete_link" data-bind="click: function() {if($('#question_form').valid()){ viewModel.removeQuestion(question);} else {viewModel.removeIfQuestionIsSelectedQuestion(question);} }">Delete</a>
                    </div>
                 </li>
                 <span class="selected_question_arrow"
                              data-bind="css:{inline:question == viewModel.selectedQuestion()}"></span>
             </div>
             {% templatetag openvariable %}/each{% templatetag closevariable %}
             </ul>
        </div>
    </script>
    <script type="text/javascript" src="/media/javascript/edit_form.js"></script>
{% endblock %}


{% block content %}
    {% block secondary_navigation_subjects %}
        {% activetab "secondary_tab_nav" "criteria" %}
        {{ block.super }}
    {% endblock %}
    {% block messages %}
      <div id="message-label" class="message-box none">
      </div>
  {% endblock %}
    <div id="questionnaire">
        <form id="question_form">
            {% csrf_token %}
            <fieldset>
                <ul class="questionnaire_code">
                    {% ifequal questionnaire_code "" %}
                    <li>
                        <label class="grid_7">{% trans "Add a new subject type" %}:</label>
                        <input type="text" maxlength="20" name="entity_type_regex" id="id_entity_type_text">
                    </li>
                    {% endifequal %}
                    <li>
                        <label class="grid_7">{% trans "Questionnaire Code :" %}</label>
                        <input id='q-type' type='hidden' value="subject" class='required'/>
                        <input type="hidden" id='saved-questionnaire-code' value="{{ questionnaire_code }}"/>
                        <input id='questionnaire-code' class='required' value="{{ questionnaire_code }}"/>
                        <span id="questionnaire-code-error"></span>
                    </li>
                </ul>
                <div class="questionnare_content grid_23 alpha omega">
                    <div>
                        <div id="questions-panel" class="grid_8 alpha">
                            <h4>{% trans "Questions" %}</h4>
                            <div data-bind="template: 'question-list-template_new'" ></div>
                            <div class="add_question">
                                <a class="add_link" href="questionnaire.html#"
                                   data-bind="click: function() { if($('#question_form').valid()) viewModel.addQuestion();}">
                                    {% trans "Add another Question" %}</a>
                            </div>
                        </div>

                        <div id="question-detail-panel">
                            <div>
                                {% include 'project/question_detail_panel.html' %}
                            </div>
                            <div class="grid_1 alpha text_align_right">
                                <img src="/media/images/help_icon.png" class="help_icon" style="margin-top:-1px;">
                                <div class="tooltip"><p>
                                    <strong>{% trans "What is this?" %}</strong><br />
                                    {% trans "q_tooltip_question_sms" %}
                                    <br /><br />
                                    <strong>{% trans "What do I need to do?" %}</strong><br />
                                    {% trans "r_tooltip_question_sms" %}
                                </p></div>
                            </div>
                            <div class="grid_12 alpha omega">
                                <div id='char-count'>
                                </div>
                            </div>
                            <div class="margin_top_10 float_left">
                                <input id="submit-button" type="submit" class="button" value="{% trans 'submit' %}" />
                            </div>
                        </div>

                    </div>
                </div>
            </fieldset>
        </form>
    </div>
{% endblock %}