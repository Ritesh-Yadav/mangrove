{% extends 'layout.html' %}

{% block page_title %} Create a Questionnaire {% endblock %}
{% block page_js %}
    <script type="text/javascript" src="/media/javascript/questionnaire.js"></script>
    <script type="text/javascript" src="/media/javascript/csrf_token_handler.js"></script>
    <script type="text/javascript">
     var question_list=JSON.parse('{{existing_questions|safe}}');
     question_list.forEach(function(question){
        viewModel.loadQuestion(new Question(question.name,question.question_code,question.label.eng,question.type,[]));
     });
     </script>
{% endblock %}



{% block content %}
    {% csrf_token %}
    <div id="message-label">
    </div>
    <div class="span-24 box">
        <div id="questions-panel" class="span-6 first" >
            <div data-bind="template: 'question-list-template'" class="first">
            </div>
            <div class="last">
                <a href="#" data-bind="click: function() { viewModel.addQuestion(); }">Add a Question</a>
            </div>
        </div>
        <div id="question-detail-panel" class="span-18 last">

            <table>
                <tr>
                    <td>
                        Question
                    </td>
                    <td>
                        <input data-bind="value: selectedQuestion().title"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        Code
                    </td>
                    <td>
                        <input data-bind="value: selectedQuestion().code"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        Description
                    </td>
                    <td>
                        <input data-bind="value: selectedQuestion().description"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        Type
                    </td>
                    <td>
                        <div><input type="radio" name="type" value="text" data-bind="checked: selectedQuestion().type" class="required"  /> Word or Phrase</div>
                        <div><input type="radio" name="type" value="integer" data-bind="checked: selectedQuestion().type" class="required" /> Number</div>
                        <div><input type="radio" name="type" value="choice" data-bind="checked: selectedQuestion().type,click:function(){ viewModel.clearChoices(); return true;}" class="choice-question-checkbox required" /> List of Choices</div>
                    </td>
                </tr>
                <tr data-bind="visible: viewModel.showAddChoice()">
                    <td>
                        &nbsp;
                    </td>
                    <td>
                        <div>
                            <div data-bind="template: { name : 'choice-template',foreach : selectedQuestion().choices }">
                            </div>
                            <a href="#"data-bind="click: function() { viewModel.addOptionToQuestion(); }">Add Choice</a>
                        </div>
                    </td>
                </tr>
            </table>

        </div>
        <div>

        </div>
    </div>
    <input id="submit-button" type="button" value="Save Questionnaire"/>

    <script type="text/html" id="choice-template">
            <p>
                <input  data-bind="value: value" />
                <a href="#" data-bind="click:function(){viewModel.removeOptionFromQuestion($data)}" >Delete</a>
                
            </p>
    </script>
    <script type="text/html" id="question-list-template">
        <table>
            {% templatetag openvariable %}each(i,question) questions{% templatetag closevariable %}
                <p>
                    <a href="#" data-bind="text: question.display, click: function() { viewModel.changeSelectedQuestion(question); } ">
                    </a>
                    <span data-bind="visible: viewModel.canQuestionBeDeleted()">
                    <a href="#" data-bind="click: function() { viewModel.removeQuestion(question); }">Delete</a>
                    </span>
                </p>
            {% templatetag openvariable %}/each{% templatetag closevariable %}
        </table>
    </script>
{% endblock %}